YUI.add("inputex-list",function(e,t){var n=e.Lang,r=e.inputEx;r.ListField=function(e){this.subFields=[],r.ListField.superclass.constructor.call(this,e)},e.extend(r.ListField,r.Field,{arrowAnimColors:{from:"#FFFF99",to:"#FFFFFF"},setOptions:function(t){r.ListField.superclass.setOptions.call(this,t),this.messages=e.mix(this.messages,e.Intl.get("inputex-list")),this.options.className=t.className?t.className:"inputEx-Field inputEx-ListField",this.options.sortable=n.isUndefined(t.sortable)?!1:t.sortable,this.options.elementType=t.elementType||{type:"string"},this.options.useButtons=n.isUndefined(t.useButtons)?!1:t.useButtons,this.options.unique=n.isUndefined(t.unique)?!1:t.unique,this.options.listAddLabel=t.listAddLabel||this.messages.listAddLink,this.options.listRemoveLabel=t.listRemoveLabel||this.messages.listRemoveLink,this.options.maxItems=t.maxItems,this.options.minItems=t.minItems},renderComponent:function(){this.options.useButtons&&(this.addButton=r.cn("img",{src:r.spacerUrl,className:"inputEx-ListField-addButton"}),this.fieldContainer.appendChild(this.addButton)),this.fieldContainer.appendChild(r.cn("span",null,{marginLeft:"4px"},this.options.listLabel)),this.childContainer=r.cn("div",{className:"inputEx-ListField-childContainer"}),this.fieldContainer.appendChild(this.childContainer),this.options.useButtons||(this.addButton=r.cn("a",{className:"inputEx-ListField-addLink"},null,this.options.listAddLabel),this.fieldContainer.appendChild(this.addButton))},initEvents:function(){e.one(this.addButton).on("click",this.onAddButton,this,!0)},validate:function(){var e=!0,t={},i=this.subFields.length;n.isNumber(this.options.minItems)&&i<this.options.minItems&&(e=!1),n.isNumber(this.options.maxItems)&&i>this.options.maxItems&&(e=!1);for(var s=0;s<i&&e;s++){var o=this.subFields[s],u=o.getState();o.setClassFromState(u);if(u==r.stateRequired||u==r.stateInvalid)e=!1;if(this.options.unique){var a=n.dump(o.getValue());t[a]?e=!1:t[a]=!0}}return e},setValue:function(e,t){if(!n.isArray(e))throw new Error("inputEx.ListField.setValue expected an array, got "+typeof e);for(var i=0;i<e.length;i++)i==this.subFields.length?this.addElement(e[i]):this.subFields[i].setValue(e[i],!1);var s=this.subFields.length-e.length;if(s>0)for(i=0;i<s;i++)this.removeElement(e.length);r.ListField.superclass.setValue.call(this,e,t)},getValue:function(){var e=[];for(var t=0;t<this.subFields.length;t++)e[t]=this.subFields[t].getValue();return e},addElement:function(e){var t=this.renderSubField(e);return this.options.name&&t.setFieldName(this.options.name+"["+this.subFields.length+"]"),this.subFields.push(t),t},resetAllNames:function(){if(this.options.name)for(var e=0;e<this.subFields.length;e++){var t=this.subFields[e];t.setFieldName(this.options.name+"["+e+"]")}},onAddButton:function(e){e.halt();if(n.isNumber(this.options.maxItems)&&this.subFields.length>=this.options.maxItems)return;var t=this.addElement();t.focus(),this.fireUpdatedEvt()},renderSubField:function(t){var i=r.cn("div"),s;this.options.useButtons&&(s=r.cn("img",{src:r.spacerUrl,className:"inputEx-ListField-delButton"}),e.one(s).on("click",this.onDelete,this),i.appendChild(s));var o=e.merge({},this.options.elementType);n.isUndefined(t)||(o.value=t);var u=r(o,this),a=u.getEl();e.one(a).addClass("inputEx-ListField-subFieldEl"),i.appendChild(a),u.on("updated",this.onChange,this,!0);if(this.options.sortable){var f=r.cn("div",{className:"inputEx-ListField-Arrow inputEx-ListField-ArrowUp"});e.one(f).on("click",this.onArrowUp,this);var l=r.cn("div",{className:"inputEx-ListField-Arrow inputEx-ListField-ArrowDown"});e.one(l).on("click",this.onArrowDown,this,!0),i.appendChild(f),i.appendChild(l)}return this.options.useButtons||(s=r.cn("a",{className:"inputEx-ListField-delLink"},null,this.options.listRemoveLabel),e.one(s).on("click",this.onDelete,this),i.appendChild(s)),i.appendChild(r.cn("div",null,{clear:"both"})),this.childContainer.appendChild(i),u},onArrowUp:function(t){var n=t.target._node.parentNode,r=null,i=-1;for(var s=1;s<n.parentNode.childNodes.length;s++){var o=n.parentNode.childNodes[s];if(o==n){r=n.parentNode.childNodes[s-1],i=s;break}}if(r){var u=this.childContainer.removeChild(n);this.childContainer.insertBefore(u,r);var a=this.subFields[i];this.subFields[i]=this.subFields[i-1],this.subFields[i-1]=a,this.resetAllNames(),this.arrowAnim&&this.arrowAnim.stop(!0),this.arrowAnim=new e.Anim({node:u,from:{backgroundColor:this.arrowAnimColors.from},to:{backgroundColor:this.arrowAnimColors.to},duration:.4}),this.arrowAnim.on("end",function(){e.one(u).setStyle("backgroundColor","")}),this.arrowAnim.run(),this.fireUpdatedEvt()}},onArrowDown:function(t){var n=t.target._node.parentNode,r=-1,i=null;for(var s=0;s<n.parentNode.childNodes.length;s++){var o=n.parentNode.childNodes[s];if(o==n){i=n.parentNode.childNodes[s+1],r=s;break}}if(i){var u=this.childContainer.removeChild(n);e.one(i).insert(u,"after");var a=this.subFields[r];this.subFields[r]=this.subFields[r+1],this.subFields[r+1]=a,this.resetAllNames(),this.arrowAnim&&this.arrowAnim.stop(!0),this.arrowAnim=new e.Anim({node:u,from:{backgroundColor:this.arrowAnimColors.from},to:{backgroundColor:this.arrowAnimColors.to},duration:1}),this.arrowAnim.on("end",function(){e.one(u).setStyle("backgroundColor","")}),this.arrowAnim.run(),this.fireUpdatedEvt()}},onDelete:function(e){e.halt();if(n.isNumber(this.options.minItems)&&this.subFields.length<=this.options.minItems)return;var t=e.target._node.parentNode,r=-1,i=t.childNodes[this.options.useButtons?1:0];for(var s=0;s<this.subFields.length;s++)if(this.subFields[s].getEl()==i){r=s;break}r!=-1&&this.removeElement(r),this.resetAllNames(),this.fireUpdatedEvt()},removeElement:function(e){var t=this.subFields[e].getEl().parentNode;this.subFields[e]=undefined,this.subFields=r.compactArray(this.subFields),t.parentNode.removeChild(t)},clear:function(e){this.setValue(n.isUndefined(this.options.value)?[]:this.options.value,e)}}),r.registerType("list",r.ListField,[{type:"string",label:"List label"
,name:"listLabel",value:""},{type:"type",label:"List element type",required:!0,name:"elementType"}])},"@VERSION@",{requires:["inputex-field","anim-base","anim-color"],skinnable:!0,ix_provides:"list",lang:["en","fr","de","ca","es","fr","it","nl"]});
