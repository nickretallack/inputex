YUI.add("inputex-form",function(e,t){var n=e.Lang,r=e.inputEx;r.Form=function(e){r.Form.superclass.constructor.call(this,e)},e.extend(r.Form,r.Group,{setOptions:function(t){r.Form.superclass.setOptions.call(this,t),this.messages=e.mix(this.messages,e.Intl.get("inputex-form")),this.buttons=[],this.options.buttons=t.buttons||[],this.options.action=t.action,this.options.method=t.method,this.options.className=t.className||"inputEx-Group",this.options.autocomplete=n.isUndefined(t.autocomplete)?r.browserAutocomplete:t.autocomplete,this.options.enctype=t.enctype,t.ajax&&(this.options.ajax={},this.options.ajax.method=t.ajax.method||"POST",this.options.ajax.uri=t.ajax.uri||"default.php",this.options.ajax.callback=t.ajax.callback||{},this.options.ajax.callback.scope=t.ajax.callback&&t.ajax.callback.scope||this,this.options.ajax.showMask=n.isUndefined(t.ajax.showMask)?!1:t.ajax.showMask,this.options.ajax.contentType=t.ajax.contentType||"application/json",this.options.ajax.wrapObject=t.ajax.wrapObject),n.isFunction(t.onSubmit)&&(this.options.onSubmit=t.onSubmit)},render:function(){this.divEl=r.cn("div",{className:this.options.className}),this.options.id&&(this.divEl.id=this.options.id),this.form=r.cn("form",{method:this.options.method||"POST",action:this.options.action||"",className:this.options.className||"inputEx-Form"}),this.divEl.appendChild(this.form),this.options.enctype&&this.form.setAttribute("enctype",this.options.enctype),this.form.setAttribute("autocomplete",this.options.autocomplete),this.options.formName&&(this.form.name=this.options.formName),this.renderFields(this.form),this.renderButtons(),this.options.disabled&&this.disable()},renderButtons:function(){var e,t,n,i=this.options.buttons.length;this.buttonDiv=r.cn("div",{className:"inputEx-Form-buttonBar"});for(n=0;n<i;n++){e=this.options.buttons[n];if(!e)throw new Error("inputEx.Form: One of the provided button is undefined ! (check trailing comma)");t=new r.widget.Button(e),t.render(this.buttonDiv),this.buttons.push(t)}this.buttonDiv.appendChild(r.cn("div",null,{clear:"both"})),this.form.appendChild(this.buttonDiv)},initEvents:function(){var t,n;r.Form.superclass.initEvents.call(this),this.publish("submit"),this.publish("afterValidation"),e.on("submit",function(e){e.halt(),this.fire("submit")},this.form,this);for(t=0,n=this.buttons.length;t<n;t++)this.buttons[t].on("submit",function(){this.fire("submit")},this);this.on("submit",this.options.onSubmit||this.onSubmit,this)},onSubmit:function(){if(!this.validate())return;this.fire("afterValidation");if(this.options.ajax){this.asyncRequest();return}this.form.submit()},asyncRequest:function(){this.options.ajax.showMask&&this.showMask();var t=this.getValue(),r,i,s,o,u,a,f,l,c,h,p;r=n.isFunction(this.options.ajax.uri)?this.options.ajax.uri(t):this.options.ajax.uri,i=n.isFunction(this.options.ajax.method)?this.options.ajax.method(t):this.options.ajax.method,s=null,o={};if(this.options.ajax.contentType==="application/x-www-form-urlencoded"&&i!=="PUT"){o["Content-Type"]="application/x-www-form-urlencoded",u=[];for(a in t)t.hasOwnProperty(a)&&(f=(this.options.ajax.wrapObject?this.options.ajax.wrapObject+"[":"")+a+(this.options.ajax.wrapObject?"]":""),u.push(f+"="+window.encodeURIComponent(t[a])));s=u.join("&")}else o["Content-Type"]="application/json",i==="PUT"?(l=this.getValue(),this.options.ajax.wrapObject?(c={},c[this.options.ajax.wrapObject]=l):c=l,s=e.JSON.stringify(c)):s=e.JSON.stringify(this.getValue());h=function(){this.options.ajax.showMask&&this.hideMask(),n.isFunction(this.options.ajax.callback.success)&&this.options.ajax.callback.success.apply(this.options.ajax.callback.scope,arguments)},p=function(){this.options.ajax.showMask&&this.hideMask(),n.isFunction(this.options.ajax.callback.failure)&&this.options.ajax.callback.failure.apply(this.options.ajax.callback.scope,arguments)},e.io(r,{method:i,data:s,headers:o,on:{success:h,failure:p},context:this})},renderMask:function(){if(this.maskRendered)return;e.one(this.divEl).setStyle("position","relative"),e.UA.ie>0&&e.one(this.divEl).setStyle("zoom",1),this.formMask=r.cn("div",{className:"inputEx-Form-Mask"},{display:"none",width:this.divEl.offsetWidth+"px",height:this.divEl.offsetHeight+"px"},"<div class='inputEx-Form-Mask-bg'/><center><br/><div class='inputEx-Form-Mask-spinner'></div><br /><span>"+this.messages.ajaxWait+"</span></div>"),this.divEl.appendChild(this.formMask),this.maskRendered=!0},showMask:function(){this.renderMask(),this.toggleSelectsInIE(!1),this.formMask.style.display=""},hideMask:function(){this.toggleSelectsInIE(!0),this.formMask.style.display="none"},toggleSelectsInIE:function(t){if(!!e.UA.ie&&e.UA.ie<7){var n=t?"removeClass":"addClass";e.one(this.divEl).all("select").each(function(e){e[n]("inputEx-hidden")})}},enable:function(){r.Form.superclass.enable.call(this);for(var e=0;e<this.buttons.length;e++)this.buttons[e].enable()},disable:function(){r.Form.superclass.disable.call(this);for(var e=0;e<this.buttons.length;e++)this.buttons[e].disable()},destroy:function(){var t,n,i;e.Event.purgeElement(this.form);for(t=0,n=this.buttons.length;t<n;t++)i=this.buttons[t],i.destroy();r.Form.superclass.destroy.call(this)}}),r.registerType("form",r.Form,[{type:"list",label:"Buttons",name:"buttons",elementType:{type:"group",fields:[{label:"Label",name:"value"},{type:"select",label:"Type",name:"type",choices:[{value:"button"},{value:"submit"}]}]}}])},"@VERSION@",{requires:["io-base","json-stringify","inputex-group","inputex-button"],ix_provides:"form",skinnable:!0,lang:["en","fr","de","ca","es","fr","it","nl"]});
